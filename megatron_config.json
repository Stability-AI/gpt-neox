{"launcher": "slurm", "train_batch_size": 128, "train_micro_batch_size_per_gpu": 4, "gradient_accumulation_steps": 2, "optimizer": {"type": "Adam", "params": {"lr": 0.00034, "betas": [0.9, 0.95], "eps": 1e-08}}, "fp16": {"fp16": true, "enabled": true, "loss_scale": 0, "loss_scale_window": 1000, "initial_scale_power": 12, "hysteresis": 2, "min_loss_scale": 1}, "zero_optimization": {"stage": 1, "allgather_partitions": true, "allgather_bucket_size": 1260000000, "overlap_comm": true, "reduce_scatter": true, "reduce_bucket_size": 1260000000, "contiguous_gradients": true, "cpu_offload": false}, "wall_clock_breakdown": true, "precision": "fp16", "num_layers": 24, "hidden_size": 2048, "num_attention_heads": 16, "seq_length": 4096, "max_position_embeddings": 4096, "pos_emb": "rotary", "no_weight_tying": true, "attention_config": ["flash", "flash", "flash", "flash", "flash", "flash", "flash", "flash", "flash", "flash", "flash", "flash", "flash", "flash", "flash", "flash", "flash", "flash", "flash", "flash", "flash", "flash", "flash", "flash"], "sparsity_config": {}, "scaled_upper_triang_masked_softmax_fusion": true, "bias_gelu_fusion": true, "rotary_pct": 0.25, "init_method": "small_init", "output_layer_init_method": "wang_init", "gpt_j_residual": true, "output_layer_parallelism": "column", "lr_decay_style": "cosine", "lr_decay_iters": 100, "min_lr": 3.4e-05, "optimizer_type": "Adam", "zero_stage": 1, "zero_reduce_scatter": true, "zero_contiguous_gradients": true, "zero_reduce_bucket_size": 1260000000, "zero_allgather_bucket_size": 1260000000, "lr": 0.00034, "tokenizer_type": "HFTokenizer", "train_data_paths": ["/fsx/redpajama/redpajama_neox_tokenized/arxiv/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/books/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/c4/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2019/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2020/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2021/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2022/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2023/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/github/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/stackexchange/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/wiki/tokenized_text_document"], "test_data_paths": ["/fsx/redpajama/redpajama_neox_tokenized/arxiv/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/books/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/c4/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2019/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2020/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2021/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2022/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2023/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/github/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/stackexchange/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/wiki/tokenized_text_document"], "valid_data_paths": ["/fsx/redpajama/redpajama_neox_tokenized/arxiv/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/books/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/c4/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2019/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2020/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2021/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2022/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2023/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/github/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/stackexchange/tokenized_text_document", "/fsx/redpajama/redpajama_neox_tokenized/wiki/tokenized_text_document"], "train_data_weights": [2.5, 4.5, 15.0, 17.816091954022987, 21.408045977011493, 20.617816091954023, 18.75, 21.408045977011493, 4.5, 2.0, 4.5], "valid_data_weights": [2.5, 4.5, 15.0, 17.816091954022987, 21.408045977011493, 20.617816091954023, 18.75, 21.408045977011493, 4.5, 2.0, 4.5], "test_data_weights": [2.5, 4.5, 15.0, 17.816091954022987, 21.408045977011493, 20.617816091954023, 18.75, 21.408045977011493, 4.5, 2.0, 4.5], "data_impl": "mmap", "save": "/fsx/ckpts/1b_tok=neox_data=test-s3-upload", "s3_path": "s3://stability-checkpoints-east", "s3_region": "us-east-1", "config_files": {"stable-lm-1b-rpj.yml": "{\n  # RedPajama\n\n  # parallelism settings\n  \"pipe-parallel-size\": 1,\n  \"model-parallel-size\": 1,\n\n  # model settings\n  \"num-layers\": 24,\n  \"hidden-size\": 2048,\n  \"num-attention-heads\": 16,\n  \"seq-length\": 4096,\n  \"max-position-embeddings\": 4096,\n\n  # architecture design\n  \"norm\": \"layernorm\",\n  \"pos-emb\": \"rotary\",\n  \"rotary_pct\": 0.25,\n  \"activation\": \"gelu\",\n  \"no-weight-tying\": true,\n  \"gpt_j_residual\": true,\n  \"output_layer_parallelism\": \"column\",\n\n  # init methods\n  \"init_method\": \"small_init\",\n  \"output_layer_init_method\": \"wang_init\",\n\n  # fused ops\n  \"scaled-upper-triang-masked-softmax-fusion\": true,\n  \"bias-gelu-fusion\": true,\n  \"attention-config\": [[[\"flash\"], 24]],\n\n  # optimizer settings\n  \"optimizer\": {\n    \"type\": \"Adam\",\n    \"params\": {\n      \"lr\": 3.4e-4,\n      \"betas\": [0.9, 0.95],\n      \"eps\": 1.0e-8\n    }\n  },\n  \"min_lr\": 3.4e-5,\n\n  # for all zero_optimization options, see https://www.deepspeed.ai/docs/config-json/#zero-optimizations-for-fp16-training\n  \"zero_optimization\": {\n    \"stage\": 1,\n    \"allgather_partitions\": true,\n    \"allgather_bucket_size\": 1260000000,\n    \"overlap_comm\": true,\n    \"reduce_scatter\": true,\n    \"reduce_bucket_size\": 1260000000,\n    \"contiguous_gradients\": true,\n    \"cpu_offload\": false\n  },\n\n  # batch / data settings\n  \"train_micro_batch_size_per_gpu\": 4,\n  \"gradient_accumulation_steps\": 2,\n  \"eval_batch_size\": 4,\n  \"data-impl\": \"mmap\",\n\n  # activation checkpointing\n  \"checkpoint-activations\": true,\n  \"checkpoint-num-layers\": 1,\n  \"partition-activations\": true,\n  \"synchronize-each-layer\": true,\n\n  # regularization\n  \"gradient_clipping\": 1.0,\n  \"weight-decay\": 0.1,\n  \"hidden-dropout\": 0,\n  \"attention-dropout\": 0,\n\n  # precision settings\n  \"fp16\": {\n    \"fp16\": true,\n    \"enabled\": true,\n    \"loss_scale\": 0,\n    \"loss_scale_window\": 1000,\n    \"initial_scale_power\": 12,\n    \"hysteresis\": 2,\n    \"min_loss_scale\": 1\n  },\n\n  # misc. training settings\n  # 66k iters ~= 550B tokens at bs=8.3M\n  # 120k iters = 1T tokens at bs=8.3M\n  # 240k iters = 1T tokens at bs=4.1M\n  # 180k iters = 1.5T tokens at bs=8.3M\n  # 360k iters = 3T tokens at bs=4.1M\n  \"train-iters\": 100,\n  \"lr-decay-iters\": 100,\n  \"distributed-backend\": \"nccl\",\n  \"lr-decay-style\": \"cosine\",\n  \"warmup\": 0.01,\n  \"checkpoint-factor\": 10,\n  # 1 more than checkpoint-factor to avoid skipping evals if `evaluate` fails\n  \"eval-interval\": 11,\n  \"eval-iters\": 10,\n  # early logarithmic save iters:\n  # \"extra-save-iters\": [0,1,2,4,8,16,32,64,128,256,512,1024,2048],\n  \"eval_tasks\": [\"lambada_openai\", \"piqa\", \"sciq\"],\n\n  # checkpoint settings\n  \"save\": \"/fsx/ckpts/1b_tok=neox_data=test-s3-upload\",\n  \"load\": \"/fsx/ckpts/1b_tok=neox_data=test-s3-upload\",\n\n  # s3 settings\n  \"s3_path\": \"s3://stability-checkpoints-east\",\n  \"s3_region\": \"us-east-1\",\n\n  # data settings\n  # (AWS East paths)\n  \"train-data-paths\": [\"/fsx/redpajama/redpajama_neox_tokenized/arxiv/tokenized_text_document\", \"/fsx/redpajama/redpajama_neox_tokenized/books/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/c4/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2019/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2020/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2021/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2022/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2023/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/github/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/stackexchange/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/wiki/tokenized_text_document\"],\n  \"train-data-weights\": [2.5, 4.5, 15.0, 17.816091954022987, 21.408045977011493, 20.617816091954023, 18.75, 21.408045977011493, 4.5, 2.0, 4.5],\n  \"valid-data-paths\": [\"/fsx/redpajama/redpajama_neox_tokenized/arxiv/tokenized_text_document\", \"/fsx/redpajama/redpajama_neox_tokenized/books/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/c4/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2019/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2020/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2021/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2022/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2023/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/github/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/stackexchange/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/wiki/tokenized_text_document\"],\n  \"valid-data-weights\": [2.5, 4.5, 15.0, 17.816091954022987, 21.408045977011493, 20.617816091954023, 18.75, 21.408045977011493, 4.5, 2.0, 4.5],\n  \"test-data-paths\": [\"/fsx/redpajama/redpajama_neox_tokenized/arxiv/tokenized_text_document\", \"/fsx/redpajama/redpajama_neox_tokenized/books/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/c4/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2019/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2020/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2021/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2022/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/common-crawl-by-year/2023/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/github/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/stackexchange/tokenized_text_document\",  \"/fsx/redpajama/redpajama_neox_tokenized/wiki/tokenized_text_document\"],\n  \"test-data-weights\": [2.5, 4.5, 15.0, 17.816091954022987, 21.408045977011493, 20.617816091954023, 18.75, 21.408045977011493, 4.5, 2.0, 4.5],\n\n  # tokenizer settings\n  \"tokenizer-type\": \"HFTokenizer\",\n  \"vocab-file\": \"/fsx/pile/20B_tokenizer.json\",\n\n  # log settings\n  \"log-interval\": 10,\n  \"steps_per_print\": 10,\n  \"wall_clock_breakdown\": true,\n\n  \"use_wandb\": true,\n  \"wandb_host\": \"https://stability.wandb.io\",\n  \"wandb_team\": \"stability-llm\",\n  \"wandb_project\": \"stable-lm\",\n  \"wandb_group\": \"1B\",\n  \"wandb_name\": \"1B.neox.redpajama\",\n  # \"wandb_id\": \"\",\n  # \"wandb_resume\": \"must\",\n\n  # multi-node launcher\n  \"launcher\": \"slurm\",\n  \"deepspeed_slurm\": true\n}"}, "load": "/fsx/ckpts/1b_tok=neox_data=test-s3-upload", "checkpoint_factor": 10, "batch_size": 4, "train_iters": 100, "eval_iters": 10, "eval_batch_size": 4, "eval_interval": 11, "vocab_file": "/fsx/pile/20B_tokenizer.json", "attention_dropout": 0, "hidden_dropout": 0, "weight_decay": 0.1, "checkpoint_activations": true, "synchronize_each_layer": true, "partition_activations": true, "gas": 2, "clip_grad": 1.0, "dynamic_loss_scale": true, "pipe_parallel_size": 1, "world_size": 16, "use_wandb": true, "wandb_group": "1B", "wandb_team": "stability-llm", "wandb_project": "stable-lm", "wandb_host": "https://stability.wandb.io", "wandb_id": "2594anl7", "wandb_name": "1B.neox.redpajama", "log_interval": 10, "text_gen_type": "unconditional", "eval_tasks": ["lambada_openai", "piqa", "sciq"], "local_rank": 0, "rank": 0, "deepspeed_slurm": true, "user_script": "train.py", "save_iters": [10, 20, 30, 40, 50, 60, 70, 80, 90], "global_num_gpus": 16}